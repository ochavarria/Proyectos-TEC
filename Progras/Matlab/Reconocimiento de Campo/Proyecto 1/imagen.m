function imagen    pkg load image    pkg load video    f = avifile("test.avi", "codec", "msmpeg4v2") ; %Archivo de video a crear   for i2 = 1:155     im=aviread("fut.avi",i2);     #Aqui se lee la imagen desde el video    imf = imfilter(im, fspecial('gaussian',30)); %filtro a la imagen para calcular la mascara    im2 = rgb2hsv(im); % Imagen a HSV    [filas,columnas] = size(im2);    %Inicia ciclo para detectar campo y jugadores al mismo tiempo    for i=1:filas      for j=1:columnas/3        %RGB utilizado en el calculo de la mascara de la imagen        r = imf(i,j,1);        g = imf(i,j,2);        b = imf(i,j,3);        % Condicion para detectar campo o no        if r>=g || b>=g || !(g>r && g>b) || (i<filas*0.25 && j>(columnas/3)*0.65)            green(i,j)=0;        else            green(i,j)=1;        endif        %Para detectar jugadores        if(im2(i,j)>=  0.33333 && !(i<filas*0.25 && j>(columnas/3)*0.65))          (im2(i,j,1)=1);          (im2(i,j,2)=1);          (im2(i,j,3)=1);         else          (im2(i,j,1)=0);          (im2(i,j,2)=0);          (im2(i,j,3)=0);        endif       endfor    endfor  [B,L] = bwboundaries(green,4); %Calculo de mascara, eliminando imperfecciones  bw= im2bw(im2,v=graythresh(im2)); %BW a la imagen de jugadores  BW2 = bwfill(bw,1,1,8); %Buscar conexiones en los jugadores  BW4 = bwfill(BW2,'holes'); %Rellenar hoyos en la imagen de jugadores  BW5=BW4.*bwareaopen(L, 6000); %Mezclar jugadores y mascara del campo  BW5=bwareaopen(BW5, 30); %Quitar imperfecciones  addframe (f, BW5); %Agregarlo al Video nuevo    #Aqui termina transformacion de la imagen.   endforend